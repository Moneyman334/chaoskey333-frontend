<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FrankensteinVault333</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
</head>
<body class="vault">
  <div id="terminalOverlay">Initializing Vault Resurrection...</div>
  
  <!-- Cosmic Replay Terminal v2.0 - Ascension Edition -->
  <div id="cosmicReplayTerminal">
    <div class="cosmic-terminal-content">
      <div class="cosmic-header">
        âš¡ COSMIC REPLAY TERMINAL v2.0 - ASCENSION EDITION âš¡
      </div>
      
      <div class="ascension-nexus-container">
        <div class="nexus-schematic">
          <div class="circuit-board">
            <!-- Ascension Replay Nexus Circuit Nodes -->
            <div class="circuit-node" style="top: 20%; left: 15%;" data-node="input"></div>
            <div class="circuit-node" style="top: 20%; left: 50%;" data-node="decode"></div>
            <div class="circuit-node" style="top: 20%; left: 85%;" data-node="output"></div>
            
            <div class="circuit-node" style="top: 50%; left: 25%;" data-node="replay"></div>
            <div class="circuit-node" style="top: 50%; left: 75%;" data-node="evolution"></div>
            
            <div class="circuit-node" style="top: 80%; left: 50%;" data-node="nexus-core"></div>
            
            <!-- Circuit Paths -->
            <div class="circuit-path" style="top: 20%; left: 15%; width: 35%;"></div>
            <div class="circuit-path" style="top: 20%; left: 50%; width: 35%;"></div>
            
            <div class="circuit-vertical" style="top: 25%; left: 25%;"></div>
            <div class="circuit-vertical" style="top: 25%; left: 75%;"></div>
            
            <div class="circuit-path" style="top: 50%; left: 25%; width: 50%;"></div>
            
            <div class="circuit-vertical" style="top: 55%; left: 50%;"></div>
          </div>
          
          <div class="evolution-loop-indicator">
            âˆ REPLAYâ†’DECODEâ†’EVOLUTION LOOP ACTIVE âˆ
          </div>
        </div>
        
        <div class="replay-status-panel">
          <div style="color: #00ffcc; font-weight: bold; margin-bottom: 10px;">NEXUS STATUS:</div>
          <div class="status-line"><span class="pulse-indicator"></span>Input Node: READY</div>
          <div class="status-line"><span class="pulse-indicator"></span>Decode Matrix: ACTIVE</div>
          <div class="status-line"><span class="pulse-indicator"></span>Replay Buffer: SYNCED</div>
          <div class="status-line"><span class="pulse-indicator"></span>Evolution Core: ONLINE</div>
          <div class="status-line"><span class="pulse-indicator"></span>Nexus Core: ASCENDED</div>
          
          <div style="margin-top: 20px; color: #ff00cc;">CIRCUIT FLOW:</div>
          <div class="status-line" style="font-size: 0.8rem;">â†’ Cosmic signal input</div>
          <div class="status-line" style="font-size: 0.8rem;">â†’ Quantum decode process</div>
          <div class="status-line" style="font-size: 0.8rem;">â†’ Replay synchronization</div>
          <div class="status-line" style="font-size: 0.8rem;">â†’ Evolution amplification</div>
          <div class="status-line" style="font-size: 0.8rem;">â†’ Nexus core integration</div>
          
          <div style="margin-top: 20px; color: #00ff88;">PRECISION METRICS:</div>
          <div class="status-line" style="font-size: 0.8rem;">Timing: 99.97% sync</div>
          <div class="status-line" style="font-size: 0.8rem;">Fidelity: 100% pure</div>
          <div class="status-line" style="font-size: 0.8rem;">Loop coherence: OPTIMAL</div>
        </div>
      </div>
      
      <div class="cosmic-controls">
        <button class="cosmic-btn" onclick="initializeReplaySequence()">INITIALIZE REPLAY</button>
        <button class="cosmic-btn" onclick="amplifyEvolutionLoop()">AMPLIFY EVOLUTION</button>
        <button class="cosmic-btn" onclick="engageAscensionMode()">ENGAGE ASCENSION</button>
        <button class="cosmic-btn" onclick="closeCosmicTerminal()">CLOSE TERMINAL</button>
      </div>
    </div>
  </div>
  
  <div class="resurrection-container">
    <h1 class="glow">âš¡ Frankenstein Vault Resurrection 333 âš¡</h1>
    <p class="pulse">Bass Surge Incoming...</p>
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Frankenstein_Dracula.jpg" alt="Frankenstein" class="frank-img" />
    <audio id="bassDrop" autoplay loop>
      <source src="https://frankenstein333.33.amazonaws.com/resurrect_bass.mp3" type="audio/mp3" />
    </audio>
    <button onclick="resurrect()">âš¡ Ignite Vault âš¡</button>
    <button id="connectWallet">ğŸ”Œ Connect Wallet</button>
    <button id="connectCoinbase" style="background-color: #1652f0; color: white;">ğŸ”µ Coinbase Wallet</button>
    <button id="paymentBtn" style="background-color: #6772e5; color: white; font-size: 1.2rem; padding: 15px 25px;">ğŸ’³ Pay $33.33 & Mint Relic</button>
    <button onclick="testStripeConnection()" style="background-color: #28a745; color: white; margin-top: 10px;">ğŸ§ª Test Stripe Connection</button>
    <button onclick="testAllConnections()" style="background-color: #17a2b8; color: white; margin-top: 10px;">ğŸ”„ Test All Connections</button>
    <button onclick="openCosmicReplayTerminal()" style="background-color: #ff00cc; color: white; margin-top: 10px; font-size: 1.1rem;">ğŸŒŒ Open Cosmic Replay Terminal v2.0</button>
    <button id="mint-button">âš™ï¸ Mint Relic</button>
    <div id="mint-status">ğŸ”’ Awaiting connection & payment...</div>
    <div id="mintStatus">ğŸ”’ Connect wallet, then complete Stripe payment to mint vault relic</div>
    <div style="margin-top: 15px; font-size: 0.9rem; color: #ffaa00;">
      ğŸ’¡ Connect Wallet (MetaMask/Coinbase) â†’ Complete Stripe Payment â†’ Relic Mints to Vault
    </div>
    <div style="margin-top: 10px; font-size: 0.8rem; color: #888;">
      ğŸ”Œ No wallet? Install: <a href="https://metamask.io" target="_blank" style="color: #ff6600;">MetaMask</a> | <a href="https://wallet.coinbase.com" target="_blank" style="color: #1652f0;">Coinbase Wallet</a>
    </div>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="script.js"></script>

  <script>
    async function connectWallet() {
      if (!window.ethereum) {
        alert("ğŸ¦Š MetaMask not detected. Please install it.");
        return;
      }

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        window.walletAddress = accounts[0];
        document.getElementById("mint-status").innerText = `ğŸŸ¢ Wallet Connected: ${window.walletAddress}`;
      } catch (err) {
        alert("âš ï¸ Wallet connection failed.");
      }
    }

    async function sendMintRequest() {
      if (!window.walletAddress) {
        alert("âš ï¸ Please connect your wallet first.");
        return;
      }

      document.getElementById("mint-status").innerText = "â³ Sending mint request...";

      fetch("/api/mint", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ wallet: window.walletAddress })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById("mint-status").innerText = `ğŸ‰ Relic minted! Tx: ${data.txHash}`;
          alert(`âœ… Mint Successful!\nTransaction: ${data.txHash}`);
        } else {

<script>
  window.addEventListener("load", async () => {
    if (typeof window.ethereum === "undefined") {
      alert("ğŸ¦Š MetaMask not detected. Please install the extension.");
      return;
    }

    try {
      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
      window.walletAddress = accounts[0];
      console.log("âœ… Wallet Connected:", window.walletAddress);
    } catch (err) {
      console.error("âŒ Connection error:", err.message);
    }
  });
</script>

          throw new Error(data.error);
        }
      })
      .catch(err => {
        document.getElementById("mint-status").innerText = "âŒ Mint failed";
        alert(`âŒ Error: ${err.message}`);

<script>
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get("success") === "true") {
    window.addEventListener('load', mintRelic); // ğŸ‘ˆ Triggers mint on load
  }
</script>

      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      connectWallet(); // Auto-trigger wallet connection
      document.getElementById("mint-button").addEventListener("click", sendMintRequest);
    });
  </script>

<script>
  async function mintRelic() {
    const contractAddress = "0x1234567890abcdef1234567890abcdef12345678"; // Use your actual deployed Goerli contract address
    const abi = [
      {
        "inputs": [],
        "name": "mintRelic",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    if (!window.ethereum) {
      alert("âš ï¸ MetaMask not detected.");
      return;
    }

    try {
      await window.ethereum.request({ method: 'eth_requestAccounts' });

      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const contract = new ethers.Contract(contractAddress, abi, signer);

      const tx = await contract.mintRelic();
      await tx.wait();

      alert("âœ… Relic minted successfully! You're officially part of the ChaosKey Syndicate.");
    } catch (err) {
      console.error("âŒ Mint failed:", err);
      alert("Minting failed. Double-check wallet & gas.");
    }
  }

  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get("success") === "true") {
    mintRelic();
  }
</script>
</body>
</html>

<button id="checkout">Mint ChaosKey Relic</button>

<script>
  fetch('/config')
  .then(response => response.json())
  .then(config => {
    if (config.publicKey) {
      const stripe = Stripe(config.publicKey);
    } else {
      console.error("Stripe public key not found in config.");
    }
  })
  .catch(err => console.error("Error loading Stripe config:", err));

  document.getElementById("checkout").addEventListener("click", async () => {
    const res = await fetch("/create-checkout-session", { method: "POST" });
    const session = await res.json();
    await stripe.redirectToCheckout({ sessionId: session.id });
  });
</script>