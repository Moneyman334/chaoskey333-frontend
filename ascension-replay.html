<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå Ascension Replay Nexus - Time-Bending Relic Forge</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: radial-gradient(circle at center, #000428 0%, #004e92 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            overflow-x: hidden;
        }

        .nexus-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .nexus-header {
            text-align: center;
            margin-bottom: 40px;
            border: 3px solid #00ff00;
            border-radius: 15px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }

        .nexus-title {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 20px #00ff00;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 20px #00ff00; }
            to { text-shadow: 0 0 40px #00ff00, 0 0 60px #00ff00; }
        }

        .nexus-subtitle {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            color: #00ffff;
        }

        .nexus-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .nexus-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #6600ff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(102, 0, 255, 0.2);
        }

        .panel-title {
            color: #00ffff;
            font-size: 1.3em;
            margin: 0 0 20px 0;
            border-bottom: 1px solid #6600ff;
            padding-bottom: 10px;
        }

        .pulse-archive {
            max-height: 400px;
            overflow-y: auto;
        }

        .pulse-card {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pulse-card:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
            transform: translateY(-2px);
        }

        .pulse-card.active {
            background: rgba(255, 255, 0, 0.2);
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.6);
        }

        .pulse-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #00ff00;
        }

        .pulse-meta {
            font-size: 0.9em;
            color: #cccccc;
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .pulse-evolution {
            font-size: 0.9em;
            color: #ffff00;
        }

        .replay-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nexus-btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #006600, #00ff00);
            color: #000;
            border: none;
            border-radius: 25px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nexus-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
        }

        .nexus-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .nexus-btn.danger {
            background: linear-gradient(45deg, #660000, #ff0000);
            color: white;
        }

        .nexus-btn.warning {
            background: linear-gradient(45deg, #666600, #ffff00);
            color: #000;
        }

        .status-display {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .status-active {
            border-color: #00ff00;
            color: #00ff00;
        }

        .status-error {
            border-color: #ff0000;
            color: #ff6666;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff6600);
            width: 0%;
            transition: width 0.3s ease;
        }

        .glyph-preview {
            font-size: 2em;
            text-align: center;
            letter-spacing: 10px;
            color: #00ffff;
            margin: 15px 0;
            animation: glyphPulse 2s ease-in-out infinite;
        }

        @keyframes glyphPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .footer-controls {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #333;
        }

        .footer-controls a {
            color: #00ffff;
            text-decoration: none;
            margin: 0 15px;
            transition: color 0.3s ease;
        }

        .footer-controls a:hover {
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }

        @media (max-width: 768px) {
            .nexus-grid {
                grid-template-columns: 1fr;
            }
            
            .nexus-title {
                font-size: 2em;
            }
            
            .replay-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="nexus-container">
        <div class="nexus-header">
            <h1 class="nexus-title">üåå ASCENSION REPLAY NEXUS</h1>
            <p class="nexus-subtitle">Time-Bending Relic Forge ‚Ä¢ Cinematic Vault Replay ‚Ä¢ Evolution Trigger</p>
        </div>

        <div class="nexus-grid">
            <div class="nexus-panel">
                <h2 class="panel-title">üìö Archived Vault Pulses</h2>
                <div id="pulseArchive" class="pulse-archive">
                    <!-- Pulse cards will be populated by JavaScript -->
                </div>
                <div class="replay-controls">
                    <button id="refreshArchive" class="nexus-btn">üîÑ Refresh Archive</button>
                    <button id="startReplay" class="nexus-btn" disabled>‚ñ∂Ô∏è Start Replay</button>
                    <button id="stopReplay" class="nexus-btn danger" disabled>‚èπÔ∏è Stop Replay</button>
                </div>
            </div>

            <div class="nexus-panel">
                <h2 class="panel-title">üé¨ Replay Status</h2>
                <div id="replayStatus" class="status-display">
Nexus initialized. Select a vault pulse to begin cinematic replay.

üîÆ Spectral Decode HUD: Ready
‚ö° Evolution Trigger: Standby  
üåå Cosmic Terminal: Online
                </div>
                <div class="progress-bar">
                    <div id="replayProgress" class="progress-fill"></div>
                </div>
                <div id="currentGlyphs" class="glyph-preview">‚óá ‚óä ‚óà ‚óâ</div>
            </div>
        </div>

        <div class="nexus-panel">
            <h2 class="panel-title">‚ö° Evolution & Forge Controls</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="color: #ffff00; margin-top: 0;">Evolution Status</h3>
                    <div id="evolutionStatus">
                        <p>Evolution Potential: <span id="evolutionPotential">0%</span></p>
                        <p>Threshold: 80% minimum for activation</p>
                        <p>Source: <span id="evolutionSource">None</span></p>
                    </div>
                </div>
                <div>
                    <h3 style="color: #ff6600; margin-top: 0;">Relic Forge</h3>
                    <div id="forgeStatus">
                        <p>Status: <span id="forgeState">Standby</span></p>
                        <p>Temporal Energy: <span id="temporalEnergy">Stable</span></p>
                        <p>Forge Temperature: <span id="forgeTemp">Cool</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-controls">
            <a href="vault.html">üîê Return to Vault</a>
            <a href="vault_viewer.html">üëÅÔ∏è Vault Viewer</a>
            <a href="cosmic_drop_page.html">üåå Cosmic Drops</a>
            <a href="index.html">üè† Main Terminal</a>
        </div>
    </div>

    <!-- Load the Ascension Replay Nexus system -->
    <script src="lib/ascension-replay-nexus.js"></script>
    <script>
        // UI Controller for Ascension Replay Nexus
        class NexusUIController {
            constructor() {
                this.selectedPulse = null;
                this.updateInterval = null;
                this.init();
            }

            async init() {
                console.log('üéÆ Initializing Nexus UI Controller...');
                
                // Wait for the nexus to be ready
                await this.waitForNexus();
                
                // Bind event listeners
                this.bindEvents();
                
                // Load pulse archive
                this.loadPulseArchive();
                
                // Start status updates
                this.startStatusUpdates();
            }

            async waitForNexus() {
                while (!window.ascensionReplayNexus) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }

            bindEvents() {
                document.getElementById('refreshArchive').onclick = () => this.loadPulseArchive();
                document.getElementById('startReplay').onclick = () => this.startReplay();
                document.getElementById('stopReplay').onclick = () => this.stopReplay();

                // Listen for evolution events
                document.addEventListener('chaos-evolution-triggered', (event) => {
                    this.handleEvolutionTriggered(event.detail);
                });
            }

            loadPulseArchive() {
                const archive = document.getElementById('pulseArchive');
                const pulses = window.ascensionReplayNexus.getArchivedPulses();
                
                archive.innerHTML = pulses.map(pulse => `
                    <div class="pulse-card" data-pulse-id="${pulse.id}">
                        <div class="pulse-title">${pulse.title}</div>
                        <div class="pulse-meta">
                            <span>${new Date(pulse.timestamp).toLocaleDateString()}</span>
                            <span>${pulse.cinematicQuality.toUpperCase()}</span>
                        </div>
                        <div class="pulse-evolution">
                            Evolution Potential: ${(pulse.evolutionPotential * 100).toFixed(1)}%
                        </div>
                    </div>
                `).join('');

                // Bind click events
                archive.querySelectorAll('.pulse-card').forEach(card => {
                    card.onclick = () => this.selectPulse(card.dataset.pulseId);
                });
            }

            selectPulse(pulseId) {
                // Remove previous selection
                document.querySelectorAll('.pulse-card').forEach(card => {
                    card.classList.remove('active');
                });

                // Select new pulse
                const pulseCard = document.querySelector(`[data-pulse-id="${pulseId}"]`);
                pulseCard.classList.add('active');

                this.selectedPulse = pulseId;
                document.getElementById('startReplay').disabled = false;

                this.updateStatus(`Selected pulse: ${pulseCard.querySelector('.pulse-title').textContent}`);
            }

            async startReplay() {
                if (!this.selectedPulse) return;

                try {
                    const pulse = await window.ascensionReplayNexus.startReplay(this.selectedPulse);
                    
                    document.getElementById('startReplay').disabled = true;
                    document.getElementById('stopReplay').disabled = false;
                    
                    this.updateStatus(`üé¨ Replay started: ${pulse.title}\nCinematic quality active\nSpectral decode HUD online`, 'active');
                    
                    // Update evolution and forge status
                    document.getElementById('evolutionPotential').textContent = `${(pulse.evolutionPotential * 100).toFixed(1)}%`;
                    document.getElementById('evolutionSource').textContent = pulse.title;
                    document.getElementById('forgeState').textContent = 'Active';
                    document.getElementById('temporalEnergy').textContent = 'Flowing';
                    document.getElementById('forgeTemp').textContent = 'Warming';

                } catch (error) {
                    this.updateStatus(`‚ùå Replay failed: ${error.message}`, 'error');
                }
            }

            async stopReplay() {
                await window.ascensionReplayNexus.stopReplay();
                
                document.getElementById('startReplay').disabled = false;
                document.getElementById('stopReplay').disabled = true;
                
                this.updateStatus('‚èπÔ∏è Replay stopped\nSpectral decode HUD offline\nEvolution trigger disabled');
                
                // Reset progress
                document.getElementById('replayProgress').style.width = '0%';
                
                // Reset evolution and forge status
                document.getElementById('evolutionPotential').textContent = '0%';
                document.getElementById('evolutionSource').textContent = 'None';
                document.getElementById('forgeState').textContent = 'Standby';
                document.getElementById('temporalEnergy').textContent = 'Stable';
                document.getElementById('forgeTemp').textContent = 'Cool';
            }

            startStatusUpdates() {
                this.updateInterval = setInterval(() => {
                    if (window.ascensionReplayNexus.isReplayActive()) {
                        const progress = window.ascensionReplayNexus.replayEngine.getProgress();
                        document.getElementById('replayProgress').style.width = progress.percentage + '%';
                    }
                }, 100);
            }

            updateStatus(message, type = '') {
                const statusElement = document.getElementById('replayStatus');
                statusElement.textContent = message;
                
                statusElement.className = 'status-display';
                if (type) {
                    statusElement.classList.add(`status-${type}`);
                }
            }

            handleEvolutionTriggered(detail) {
                this.updateStatus(`üåü EVOLUTION TRIGGERED!\nSource: ${detail.source}\nPulse: ${detail.pulseId}\nPotential: ${(detail.evolutionPotential * 100).toFixed(1)}%\nTimestamp: ${new Date(detail.timestamp).toLocaleTimeString()}`, 'active');
                
                // Flash the forge status
                document.getElementById('forgeState').textContent = 'EVOLUTION ACTIVE';
                document.getElementById('forgeTemp').textContent = 'CRITICAL';
                
                setTimeout(() => {
                    document.getElementById('forgeState').textContent = 'Post-Evolution Cool-down';
                    document.getElementById('forgeTemp').textContent = 'Cooling';
                }, 3000);
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new NexusUIController();
        });

        // Listen for vault replay frames to update glyphs
        document.addEventListener('vault-replay-frame', (event) => {
            const glyphsElement = document.getElementById('currentGlyphs');
            if (event.detail.glyph) {
                // Add the new glyph and keep last 4
                let currentGlyphs = glyphsElement.textContent.split(' ');
                currentGlyphs.push(event.detail.glyph);
                if (currentGlyphs.length > 4) {
                    currentGlyphs = currentGlyphs.slice(-4);
                }
                glyphsElement.textContent = currentGlyphs.join(' ');
            }
        });
    </script>
</body>
</html>